\doxysection{server.\+hpp}
\hypertarget{server_8hpp_source}{}\label{server_8hpp_source}\index{include/server/server.hpp@{include/server/server.hpp}}
\mbox{\hyperlink{server_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{**\ EPITECH\ PROJECT,\ 2025}}
\DoxyCodeLine{00003\ \textcolor{comment}{**\ r-\/type-\/mirror}}
\DoxyCodeLine{00004\ \textcolor{comment}{**\ File\ description:}}
\DoxyCodeLine{00005\ \textcolor{comment}{**\ server}}
\DoxyCodeLine{00006\ \textcolor{comment}{*/}}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#ifndef\ SERVER\_HPP\_}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\ \ \ \ \#define\ SERVER\_HPP\_}}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\ \ \ \ \#include\ "{}\mbox{\hyperlink{UdpServer_8hpp}{UdpServer.hpp}}"{}}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\ \ \ \ \#include\ "{}\mbox{\hyperlink{Timer_8hpp}{Timer.hpp}}"{}}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\ \ \ \ \#include\ "{}\mbox{\hyperlink{server_2ecs_8hpp}{ecs.hpp}}"{}}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\ \ \ \ \#include\ "{}\mbox{\hyperlink{Components_8hpp}{engine/systems/Components.hpp}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\ \ \ \ \#include\ "{}engine/systems/MoveSystem.hpp"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\ \ \ \ \#include\ "{}\mbox{\hyperlink{MovementSystem_8hpp}{engine/systems/MovementSystem.hpp}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\ \ \ \ \#include\ "{}\mbox{\hyperlink{WaveSystem_8hpp}{engine/systems/WaveSystem.hpp}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\ \ \ \ \#include\ "{}\mbox{\hyperlink{CollisionSystem_8hpp}{engine/systems/CollisionSystem.hpp}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\ \ \ \ \#include\ "{}\mbox{\hyperlink{serializer_8hpp}{serializer.hpp}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\ \ \ \ \#include\ "{}engine/EntityFactory.hpp"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\ \ \ \ \#include\ "{}engine/StageFactory.hpp"{}}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#define\ FRAME\ 60000}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classServer}{Server}}\ \{}
\DoxyCodeLine{00026\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{classServer}{Server}}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}\ port);}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classServer_a4b3aa2579cb1c8cd1d069582c14d0fa6}{\string~Server}}();}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classServer_aeee363eaf9f494aa542f2e0ad1d7813b}{processInputs}}();\ \textcolor{comment}{//\ Change\ position\ with\ recieved\ inputs}}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classServer_af7b0a4370ac2c1e573f292870adfa81c}{update}}();\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Updates\ ECS\ with\ systems}}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classServer_af36f3a832531844b5f18d40c6db22cc9}{broadcast}}();\ \ \ \ \ \textcolor{comment}{//\ Send\ updates\ to\ all\ clients}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classTimer}{Timer}}\ \mbox{\hyperlink{classServer_a88935f3b112369eecc2092459a3f5e58}{\_timer}};}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classServer_ab6d622740f2076240df47cf88a3eb396}{\_running}};}
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classServer_aac4110712ec347909be9bd4a5140ac4f}{applyInput}}(std::pair<int,\ InputState>\ \&\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{currentItem}});}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classServer_a167f3f27856b0e3c707f4f98c0bb75be}{entityForClients}}();\ \textcolor{comment}{//\ Create\ ECS\ Entity\ if\ a\ client\ connect\ itself}}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{uint16\_t}}\ \mbox{\hyperlink{classServer_ace7288eb50463b9c25caacef2952c00b}{\_nbPlayer}};}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ std::unordered\_map<std::size\_t,\ std::size\_t>\ \mbox{\hyperlink{classServer_ac4ba75378e7da5ff808670e5a9f99777}{clientToPlayerRelation}};}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classWaveSystem}{WaveSystem}}\ \mbox{\hyperlink{classServer_a3889c733366297a7cc54e28cb2e46234}{\_waveSystem}}\{\mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}\};}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{MoveSystem}}\ \mbox{\hyperlink{classServer_a4d13413f3e34616fd1d96744a847c323}{\_movSys}}\{\mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}\};}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMovementSystem}{MovementSystem}}\ \mbox{\hyperlink{classServer_a28a936520b381e6f0e56028653bbffa2}{\_movementSystem}}\{\mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}\};}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classUdpServer}{UdpServer}}\ \mbox{\hyperlink{classServer_a37091a3b8ed4f8919db71c594374a7b5}{\_UDP}};}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classECS}{ECS}}\ \mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}};}
\DoxyCodeLine{00049\ \};}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \mbox{\hyperlink{classServer_afdc204b21eae699fb44042665c44bbd0}{Server::Server}}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}\ port)}
\DoxyCodeLine{00052\ \ \ \ \ :\ \_UDP(\mbox{\hyperlink{classUdpServer}{UdpServer}}(port)),\ \_ecs(\mbox{\hyperlink{classECS}{ECS}}())}
\DoxyCodeLine{00053\ \{}
\DoxyCodeLine{00054\ \ \ \ \ \mbox{\hyperlink{classServer_a37091a3b8ed4f8919db71c594374a7b5}{\_UDP}}.\mbox{\hyperlink{classUdpServer_a2e6eba1c68cc214f6df97a5c7724697f}{start}}();}
\DoxyCodeLine{00055\ \ \ \ \ \mbox{\hyperlink{classServer_a88935f3b112369eecc2092459a3f5e58}{\_timer}}\ =\ \mbox{\hyperlink{classTimer}{Timer}}();}
\DoxyCodeLine{00056\ \ \ \ \ \mbox{\hyperlink{classServer_ab6d622740f2076240df47cf88a3eb396}{\_running}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00057\ \ \ \ \ \mbox{\hyperlink{classServer_ace7288eb50463b9c25caacef2952c00b}{\_nbPlayer}}\ =\ 0;}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \ \ \mbox{\hyperlink{namespaceFactory_a46cd969803b3a2d51624f7d1a880e90c}{Factory::createScreenBorders}}(\mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}},\ 1920.f,\ 1080.f,\ 5.f);}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ \ \ std::vector<WaveData\_t>\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{level}}\ =\ \{}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \{3.0f,\ \ \textcolor{stringliteral}{"{}enemy"{}},\ 6,\ \ 2000.f,\ 200.f\},}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \{8.0f,\ \ \textcolor{stringliteral}{"{}enemy"{}},\ 10,\ 2000.f,\ 400.f\},}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \{15.0f,\ \textcolor{stringliteral}{"{}enemy"{}},\ 15,\ 2000.f,\ 600.f\}}
\DoxyCodeLine{00065\ \ \ \ \ \};}
\DoxyCodeLine{00066\ \ \ \ \ \mbox{\hyperlink{classServer_a3889c733366297a7cc54e28cb2e46234}{\_waveSystem}}.\mbox{\hyperlink{classWaveSystem_afe7beb27d93fec01da74e11f0ca91960}{loadLevel}}(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{level}});}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{comment}{//\ Obstacles\ custom}}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{comment}{//\ Factory::createObstacle(\_ecs,\ 800.f,\ 200.f,\ 100.f,\ 150.f);}}
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{comment}{//\ Factory::createObstacle(\_ecs,\ 1200.f,\ 600.f,\ 80.f,\ 200.f);}}
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{comment}{//\ Factory::createObstacle(\_ecs,\ 1500.f,\ 300.f,\ 120.f,\ 100.f);}}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{comment}{//\ Grilles\ de\ tuiles\ destructibles}}
\DoxyCodeLine{00074\ \ \ \ \ \mbox{\hyperlink{namespaceFactory_a7e8cefb2f1094bf3a3b56575b315301b}{Factory::createTileGrid}}(\mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}},\ 600.f,\ 400.f,\ 3,\ 2,\ 50.f,\ 50.f,\ 50);}
\DoxyCodeLine{00075\ \ \ \ \ \mbox{\hyperlink{namespaceFactory_a7e8cefb2f1094bf3a3b56575b315301b}{Factory::createTileGrid}}(\mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}},\ 1000.f,\ 500.f,\ 3,\ 2,\ 50.f,\ 50.f,\ 50);}
\DoxyCodeLine{00076\ \}}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \mbox{\hyperlink{classServer_a4b3aa2579cb1c8cd1d069582c14d0fa6}{Server::\string~Server}}()\ \{\}}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classServer_aac4110712ec347909be9bd4a5140ac4f}{Server::applyInput}}(std::pair<int,\ InputState>\ \&\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{currentItem}})}
\DoxyCodeLine{00081\ \{}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classServer_ac4ba75378e7da5ff808670e5a9f99777}{clientToPlayerRelation}}.find(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{currentItem}}.first)\ ==\ \mbox{\hyperlink{classServer_ac4ba75378e7da5ff808670e5a9f99777}{clientToPlayerRelation}}.end())}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a9a522438c9f5d73ebe6349edc3313d5e}{Entity}}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{e}}\ =\ \mbox{\hyperlink{classServer_ac4ba75378e7da5ff808670e5a9f99777}{clientToPlayerRelation}}[\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{currentItem}}.first];}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{velo}}\ =\ \mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}.\mbox{\hyperlink{classECS_aaae60c88af59dd7af9d86200eb522bbc}{getComponent}}<\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Velocity\_t}}>(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{e}});}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{velo}})}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keywordtype}{float}\ speed\ =\ 400.0f;}
\DoxyCodeLine{00092\ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{velo}}-\/>x\ =\ 0;}
\DoxyCodeLine{00093\ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{velo}}-\/>y\ =\ 0;}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{currentItem}}.second.right)}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{velo}}-\/>x\ =\ speed;}
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{currentItem}}.second.left)}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{velo}}-\/>x\ =\ -\/speed;}
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{currentItem}}.second.up)}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{velo}}-\/>y\ =\ -\/speed;}
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{currentItem}}.second.down)}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{velo}}-\/>y\ =\ speed;}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{ctrl}}\ =\ \mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}.\mbox{\hyperlink{classECS_aaae60c88af59dd7af9d86200eb522bbc}{getComponent}}<\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{PlayerController\_t}}>(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{e}});}
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{ctrl}})\ \{}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{ctrl}}-\/>isShooting\ =\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{currentItem}}.second.shoot;}
\DoxyCodeLine{00107\ \ \ \ \ \}}
\DoxyCodeLine{00108\ \}}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classServer_aeee363eaf9f494aa542f2e0ad1d7813b}{Server::processInputs}}()}
\DoxyCodeLine{00111\ \{}
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{comment}{//\ Reset\ velocity\ for\ all\ players\ to\ prevent\ sliding}}
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pair}}\ :\ \mbox{\hyperlink{classServer_ac4ba75378e7da5ff808670e5a9f99777}{clientToPlayerRelation}})\ \{}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{velo}}\ =\ \mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}.\mbox{\hyperlink{classECS_aaae60c88af59dd7af9d86200eb522bbc}{getComponent}}<\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Velocity\_t}}>(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pair}}.second);}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{velo}})\ \{}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{velo}}-\/>x\ =\ 0;}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{velo}}-\/>y\ =\ 0;}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00119\ \ \ \ \ \}}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \ \ \ \ this-\/>\mbox{\hyperlink{classServer_a167f3f27856b0e3c707f4f98c0bb75be}{entityForClients}}();}
\DoxyCodeLine{00122\ \ \ \ \ std::pair<int,\ InputState>\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{first}};}
\DoxyCodeLine{00123\ \ \ \ \ std::pair<int,\ InputState>\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{input}};}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classServer_a37091a3b8ed4f8919db71c594374a7b5}{\_UDP}}.\mbox{\hyperlink{classUdpServer_a335a6b7cc1ac0e490efb7d560abfbcde}{receivedInputs}}.\mbox{\hyperlink{classSafeQueue_ab2f40bad1a39f332c1a8c7b4e858b190}{tryPop}}(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{first}}))}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ No\ input}}
\DoxyCodeLine{00127\ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{input}}\ =\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{first}};}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \ \ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{first}}.second.tick\ <=\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{input}}.second.tick)\ \{}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ this-\/>\mbox{\hyperlink{classServer_aac4110712ec347909be9bd4a5140ac4f}{applyInput}}(input);}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Do\ the\ next\ arg}}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classServer_a37091a3b8ed4f8919db71c594374a7b5}{\_UDP}}.\mbox{\hyperlink{classUdpServer_a335a6b7cc1ac0e490efb7d560abfbcde}{receivedInputs}}.\mbox{\hyperlink{classSafeQueue_ab2f40bad1a39f332c1a8c7b4e858b190}{tryPop}}(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{input}}))}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ No\ more\ inputs}}
\DoxyCodeLine{00134\ \ \ \ \ \}}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00136\ \ \ \ \ \textcolor{comment}{//\ still\ process\ the\ last\ input,\ you\ cant\ put\ it\ back\ in\ the\ queue\ anyways}}
\DoxyCodeLine{00137\ \ \ \ \ this-\/>\mbox{\hyperlink{classServer_aac4110712ec347909be9bd4a5140ac4f}{applyInput}}(input);}
\DoxyCodeLine{00138\ \}}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classServer_af7b0a4370ac2c1e573f292870adfa81c}{Server::update}}()}
\DoxyCodeLine{00141\ \{}
\DoxyCodeLine{00142\ \ \ \ \ \mbox{\hyperlink{classServer_a4d13413f3e34616fd1d96744a847c323}{\_movSys}}.update(1.0f\ /\ 60.f);\ \textcolor{comment}{//\ Update\ with\ fixed\ delta\ time}}
\DoxyCodeLine{00143\ \ \ \ \ \mbox{\hyperlink{classServer_a28a936520b381e6f0e56028653bbffa2}{\_movementSystem}}.\mbox{\hyperlink{classMovementSystem_afd53a085ce047480cbd2a004cb557003}{update}}(1.0f\ /\ 60.f);}
\DoxyCodeLine{00144\ \ \ \ \ \mbox{\hyperlink{classServer_a3889c733366297a7cc54e28cb2e46234}{\_waveSystem}}.\mbox{\hyperlink{classWaveSystem_a9a5c16c210763a371d4b535e76b2208c}{update}}(1.0f\ /\ 60.f);}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \ \ \ \ \textcolor{comment}{//\ Remove\ entities\ out\ of\ bounds}}
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{entities}}\ =\ \mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}.\mbox{\hyperlink{classECS_a8d931ce389d47888768e1a5092bde26b}{getEntitiesByComponents}}<\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Position\_t}}>();}
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a9a522438c9f5d73ebe6349edc3313d5e}{Entity}}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{e}}\ :\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{entities}})\ \{}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}.\mbox{\hyperlink{classECS_a33c16853296e9784dfb558f35dffbd72}{hasComponent}}<\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{PlayerController\_t}}>(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{e}}))}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}*\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pos}}\ =\ \mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}.\mbox{\hyperlink{classECS_aaae60c88af59dd7af9d86200eb522bbc}{getComponent}}<\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Position\_t}}>(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{e}});}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pos}}-\/>x\ <\ -\/100.f\ ||\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pos}}-\/>x\ >\ 2200.f\ ||\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pos}}-\/>y\ <\ -\/100.f\ ||\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pos}}-\/>y\ >\ 1200.f)\ \{}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}.\mbox{\hyperlink{classECS_a77bab58f7b7d5e53443078f60957b2d2}{killEntity}}(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{e}});}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00156\ \ \ \ \ \}}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00158\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a9a522438c9f5d73ebe6349edc3313d5e}{Entity}}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{e}}\ :\ \mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}.\mbox{\hyperlink{classECS_a8d931ce389d47888768e1a5092bde26b}{getEntitiesByComponents}}<\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{PlayerController\_t}},\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Position\_t}}>())\ \{}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}*\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{ctrl}}\ =\ \mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}.\mbox{\hyperlink{classECS_aaae60c88af59dd7af9d86200eb522bbc}{getComponent}}<\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{PlayerController\_t}}>(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{e}});}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}*\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pos}}\ =\ \mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}.\mbox{\hyperlink{classECS_aaae60c88af59dd7af9d86200eb522bbc}{getComponent}}<\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Position\_t}}>(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{e}});}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{ctrl}}\ \&\&\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{ctrl}}-\/>isShooting\ \&\&\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{ctrl}}-\/>shootCooldown\ <=\ 0.f)\ \{}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceFactory_acb4f080b19f667e0bcc6fe95c0ab1b76}{Factory::createProjectile}}(\mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}},\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pos}}-\/>x\ +\ 64.f,\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pos}}-\/>y\ +\ 20.f,\ 800.f,\ 0.f,\ 1,\ 50,\ \textcolor{stringliteral}{"{}bullet"{}},\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{e}});}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{ctrl}}-\/>shootCooldown\ =\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{SHOOT\_DELAY}};}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{ctrl}}-\/>shootCooldown\ -\/=\ 1.0f\ /\ 60.f;}
\DoxyCodeLine{00167\ \ \ \ \ \}}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00169\ \ \ \ \ \textcolor{comment}{//\ Collision\ detection}}
\DoxyCodeLine{00170\ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{projectiles}}\ =\ \mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}.\mbox{\hyperlink{classECS_a8d931ce389d47888768e1a5092bde26b}{getEntitiesByComponents}}<\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Projectile\_t}},\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Collider\_t}},\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Position\_t}}>();}
\DoxyCodeLine{00171\ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{targets}}\ =\ \mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}.\mbox{\hyperlink{classECS_a8d931ce389d47888768e1a5092bde26b}{getEntitiesByComponents}}<\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Health\_t}},\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Collider\_t}},\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Position\_t}}>();}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a9a522438c9f5d73ebe6349edc3313d5e}{Entity}}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{p}}\ :\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{projectiles}})\ \{}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{proj}}\ =\ \mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}.\mbox{\hyperlink{classECS_aaae60c88af59dd7af9d86200eb522bbc}{getComponent}}<\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Projectile\_t}}>(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{p}});}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{projCol}}\ =\ \mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}.\mbox{\hyperlink{classECS_aaae60c88af59dd7af9d86200eb522bbc}{getComponent}}<\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Collider\_t}}>(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{p}});}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{projPos}}\ =\ \mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}.\mbox{\hyperlink{classECS_aaae60c88af59dd7af9d86200eb522bbc}{getComponent}}<\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Position\_t}}>(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{p}});}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a9a522438c9f5d73ebe6349edc3313d5e}{Entity}}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{t}}\ :\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{targets}})\ \{}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{p}}\ ==\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{t}})\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{targetCol}}\ =\ \mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}.\mbox{\hyperlink{classECS_aaae60c88af59dd7af9d86200eb522bbc}{getComponent}}<\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Collider\_t}}>(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{t}});}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{targetPos}}\ =\ \mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}.\mbox{\hyperlink{classECS_aaae60c88af59dd7af9d86200eb522bbc}{getComponent}}<\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Position\_t}}>(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{t}});}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{targetHealth}}\ =\ \mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}.\mbox{\hyperlink{classECS_aaae60c88af59dd7af9d86200eb522bbc}{getComponent}}<\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Health\_t}}>(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{t}});}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ teams\ (1=player,\ 2=enemy)}}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ (projCol-\/>team\ ==\ targetCol-\/>team)\ continue;}}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{projCol}}-\/>team\ ==\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{targetCol}}-\/>team\ \&\&\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{targetCol}}-\/>team\ !=\ 0)\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ AABB\ Collision}}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{projPos}}-\/>x\ <\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{targetPos}}-\/>x\ +\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{targetCol}}-\/>width\ \&\&}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{projPos}}-\/>x\ +\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{projCol}}-\/>width\ >\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{targetPos}}-\/>x\ \&\&}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{projPos}}-\/>y\ <\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{targetPos}}-\/>y\ +\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{targetCol}}-\/>height\ \&\&}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{projPos}}-\/>y\ +\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{projCol}}-\/>height\ >\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{targetPos}}-\/>y)\ \{}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Hit!}}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{targetHealth}}-\/>current\ -\/=\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{proj}}-\/>damage;}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{targetHealth}}-\/>lastAttackerId\ =\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{proj}}-\/>ownerId;}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}.\mbox{\hyperlink{classECS_a77bab58f7b7d5e53443078f60957b2d2}{killEntity}}(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{p}});\ \textcolor{comment}{//\ Destroy\ projectile}}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};\ \textcolor{comment}{//\ Projectile\ destroyed,\ move\ to\ next\ projectile}}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00201\ \ \ \ \ \}}
\DoxyCodeLine{00202\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a9a522438c9f5d73ebe6349edc3313d5e}{Entity}}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{e}}\ :\ \mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}.\mbox{\hyperlink{classECS_a8d931ce389d47888768e1a5092bde26b}{getEntitiesByComponents}}<\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Projectile\_t}},\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Position\_t}}>())\ \{}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}*\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pos}}\ =\ \mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}.\mbox{\hyperlink{classECS_aaae60c88af59dd7af9d86200eb522bbc}{getComponent}}<\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Position\_t}}>(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{e}});}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pos}}-\/>x\ >\ 2000.f\ ||\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pos}}-\/>x\ <\ -\/100.f\ ||\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pos}}-\/>y\ >\ 1200.f\ ||\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pos}}-\/>y\ <\ -\/100.f)}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}.\mbox{\hyperlink{classECS_a77bab58f7b7d5e53443078f60957b2d2}{killEntity}}(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{e}});}
\DoxyCodeLine{00206\ \ \ \ \ \}}
\DoxyCodeLine{00207\ \}}
\DoxyCodeLine{00208\ }
\DoxyCodeLine{00209\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classServer_af36f3a832531844b5f18d40c6db22cc9}{Server::broadcast}}()}
\DoxyCodeLine{00210\ \{}
\DoxyCodeLine{00211\ \ \ \ \ \textcolor{comment}{//\ send\ every\ player\ entities\ or\ projectile\ for\ the\ moment}}
\DoxyCodeLine{00212\ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{entities}}\ =\ \mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}.\mbox{\hyperlink{classECS_a8d931ce389d47888768e1a5092bde26b}{getEntitiesByComponents}}<\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Position\_t}},\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Health\_t}},\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{SendUpdate\_t}}>();\ \textcolor{comment}{//\ Players\ \&\ Enemies}}
\DoxyCodeLine{00213\ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{clients}}\ =\ \mbox{\hyperlink{classServer_a37091a3b8ed4f8919db71c594374a7b5}{\_UDP}}.\mbox{\hyperlink{classUdpServer_a52f6bd3ca7b3f20cddee608ee96f68bb}{getClients}}();}
\DoxyCodeLine{00214\ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{uint16\_t}}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{serverTick}}\ =\ \mbox{\hyperlink{classServer_a88935f3b112369eecc2092459a3f5e58}{\_timer}}.\mbox{\hyperlink{classTimer_a8748fdae906f806c6071d2a985cdb359}{getCurrentFrame}}();}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a9a522438c9f5d73ebe6349edc3313d5e}{Entity}}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{e}}\ :\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{entities}})\ \{}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pos}}\ =\ \mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}.\mbox{\hyperlink{classECS_a358206e15202fccfa73017c47af07079}{getConstComponent}}<\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Position\_t}}>(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{e}});}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pv}}\ =\ \mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}.\mbox{\hyperlink{classECS_a358206e15202fccfa73017c47af07079}{getConstComponent}}<\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Health\_t}}>(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{e}});}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ this\ entity\ belongs\ to\ a\ client}}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{ownerClientId}}\ =\ -\/1;}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pair}}\ :\ \mbox{\hyperlink{classServer_ac4ba75378e7da5ff808670e5a9f99777}{clientToPlayerRelation}})\ \{}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pair}}.second\ ==\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{e}})\ \{}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{ownerClientId}}\ =\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pair}}.first;}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00228\ }
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{client}}\ :\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{clients}})\ \{}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{uint16\_t}}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{tickToSend}}\ =\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{serverTick}};}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{client}}.playerId\ ==\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{ownerClientId}})\ \{}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{tickToSend}}\ =\ 0xFFFF;\ \textcolor{comment}{//\ Magic\ value\ for\ "{}This\ is\ you"{}}}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00234\ }
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Handle\ death\ events}}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pv}}-\/>current\ <=\ 0)\ \{}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ this\ client\ killed\ the\ entity}}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ need\ to\ find\ the\ player\ ID\ associated\ with\ the\ lastAttackerId\ entity}}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{attackerClientId}}\ =\ -\/1;}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pair}}\ :\ \mbox{\hyperlink{classServer_ac4ba75378e7da5ff808670e5a9f99777}{clientToPlayerRelation}})\ \{}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pair}}.second\ ==\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pv}}-\/>lastAttackerId)\ \{}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{attackerClientId}}\ =\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pair}}.first;}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{client}}.playerId\ ==\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{attackerClientId}})\ \{}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{tickToSend}}\ =\ 0xFFFD;\ \textcolor{comment}{//\ You\ killed\ it}}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{tickToSend}}\ =\ 0xFFFE;\ \textcolor{comment}{//\ It\ died}}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00253\ }
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ total\ size\ needed\ (Entity\ ID\ +\ Position\ +\ Health\ (current\ +\ max))}}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Note:\ We\ manually\ serialize\ health\ to\ exclude\ lastAttackerId\ and\ match\ EntityUpdate\ struct}}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{totalSize}}\ =\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a9a522438c9f5d73ebe6349edc3313d5e}{Entity}})\ +\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{uint16\_t}})\ +\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Position\_t}})\ +\ (2\ *\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}));}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<uint8\_t>\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{packetData}}(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{totalSize}});}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{offset}}\ =\ 0;}
\DoxyCodeLine{00259\ }
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ \ \ \ \ std::memcpy(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{packetData}}.data()\ +\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{offset}},\ \&\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{e}},\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a9a522438c9f5d73ebe6349edc3313d5e}{Entity}}));}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{offset}}\ +=\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a9a522438c9f5d73ebe6349edc3313d5e}{Entity}});}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ \ \ \ \ std::memcpy(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{packetData}}.data()\ +\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{offset}},\ \&\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{tickToSend}},\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{uint16\_t}}));}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{offset}}\ +=\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{uint16\_t}});}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \ \ \ \ std::memcpy(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{packetData}}.data()\ +\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{offset}},\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pos}},\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Position\_t}}));}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{offset}}\ +=\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Position\_t}});}
\DoxyCodeLine{00266\ }
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Manual\ Health\ serialization}}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{currentHealth}}\ =\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pv}}-\/>current;}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{maxHealth}}\ =\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pv}}-\/>max;}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \ \ \ \ std::memcpy(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{packetData}}.data()\ +\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{offset}},\ \&\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{currentHealth}},\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}));}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{offset}}\ +=\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{int}});}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \ \ \ \ std::memcpy(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{packetData}}.data()\ +\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{offset}},\ \&\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{maxHealth}},\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}));}
\DoxyCodeLine{00273\ }
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classServer_a37091a3b8ed4f8919db71c594374a7b5}{\_UDP}}.\mbox{\hyperlink{classUdpServer_a7dd72b9b9f6a74a9067148b13333a7b3}{packetsToSend}}.\mbox{\hyperlink{classSafeQueue_ae51181f65378234bf3a0f66a86d4b33a}{push}}(\{\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{client}}.address,\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{client}}.port,\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{packetData}}\});}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00276\ }
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pv}}-\/>current\ <=\ 0)\ \{}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}Entity\ "{}}\ <<\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{e}}\ <<\ \textcolor{stringliteral}{"{}\ died\ (Killer:\ "{}}\ <<\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pv}}-\/>lastAttackerId\ <<\ \textcolor{stringliteral}{"{})"{}}\ <<\ std::endl;}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00280\ \ \ \ \ \}}
\DoxyCodeLine{00281\ }
\DoxyCodeLine{00282\ \ \ \ \ \textcolor{comment}{//\ Cleanup\ dead\ entities\ after\ broadcast}}
\DoxyCodeLine{00283\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a9a522438c9f5d73ebe6349edc3313d5e}{Entity}}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{e}}\ :\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{entities}})\ \{}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pv}}\ =\ \mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}.\mbox{\hyperlink{classECS_a358206e15202fccfa73017c47af07079}{getConstComponent}}<\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Health\_t}}>(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{e}});}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{pv}}-\/>current\ <=\ 0)\ \{}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}}.\mbox{\hyperlink{classECS_a77bab58f7b7d5e53443078f60957b2d2}{killEntity}}(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{e}});}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00288\ \ \ \ \ \}}
\DoxyCodeLine{00289\ \}}
\DoxyCodeLine{00290\ }
\DoxyCodeLine{00291\ \ \ \ \ \textcolor{comment}{//\ auto\ projectiles\ =\ \_ecs.getEntitiesByComponents<Projectile\_t>();}}
\DoxyCodeLine{00292\ }
\DoxyCodeLine{00293\ \ \ \ \ \textcolor{comment}{//\ for\ (Entity\ projectile\ :\ projectiles)\ \{}}
\DoxyCodeLine{00294\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ auto\ comp\ =\ \ \_ecs.getConstComponent<Projectile\_t>(projectile);}}
\DoxyCodeLine{00295\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ std::vector<uint8\_t>\ packetData(sizeof(Projectile\_t));}}
\DoxyCodeLine{00296\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ std::memcpy(packetData.data(),\ \&comp,\ sizeof(Projectile\_t));}}
\DoxyCodeLine{00297\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ std::queue<PacketToSend>\ queue\ =\ \_UDP.createEveryonePacket(packetData);}}
\DoxyCodeLine{00298\ }
\DoxyCodeLine{00299\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ while\ (!queue.empty())\ \{}}
\DoxyCodeLine{00300\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \_UDP.packetsToSend.push(queue.front());}}
\DoxyCodeLine{00301\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ queue.pop();}}
\DoxyCodeLine{00302\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \}}}
\DoxyCodeLine{00303\ \ \ \ \ \textcolor{comment}{//\ \}}}
\DoxyCodeLine{00304\ }
\DoxyCodeLine{00305\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classServer_a167f3f27856b0e3c707f4f98c0bb75be}{Server::entityForClients}}()}
\DoxyCodeLine{00306\ \{}
\DoxyCodeLine{00307\ \ \ \ \ std::size\_t\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{clientCount}}\ =\ \mbox{\hyperlink{classServer_a37091a3b8ed4f8919db71c594374a7b5}{\_UDP}}.\mbox{\hyperlink{classUdpServer_a9bbfe357b5fd6f3eae04605bb3ebce4f}{getClientCount}}();}
\DoxyCodeLine{00308\ }
\DoxyCodeLine{00309\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{clientCount}}\ ==\ this-\/>\mbox{\hyperlink{classServer_ace7288eb50463b9c25caacef2952c00b}{\_nbPlayer}})}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00311\ }
\DoxyCodeLine{00312\ \ \ \ \ std::vector<ClientInfo>\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Clients}}\ =\ \mbox{\hyperlink{classServer_a37091a3b8ed4f8919db71c594374a7b5}{\_UDP}}.\mbox{\hyperlink{classUdpServer_a52f6bd3ca7b3f20cddee608ee96f68bb}{getClients}}();}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ \&\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{client}}\ :\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{Clients}})\ \{}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classServer_ac4ba75378e7da5ff808670e5a9f99777}{clientToPlayerRelation}}.find(\mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{client}}.playerId)\ ==\ \mbox{\hyperlink{classServer_ac4ba75378e7da5ff808670e5a9f99777}{clientToPlayerRelation}}.end())\ \{}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a9a522438c9f5d73ebe6349edc3313d5e}{Entity}}\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{newEntity}}\ =\ \mbox{\hyperlink{namespaceFactory_a676a86a062ce8ffcbe6f1fb3360f5948}{Factory::createPlayer}}(\mbox{\hyperlink{classServer_aa40cf916c43ac983d372376382b5340e}{\_ecs}},\ 0.f,\ 0.f,\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{client}}.playerId,\ \textcolor{stringliteral}{"{}player"{}});}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classServer_ac4ba75378e7da5ff808670e5a9f99777}{clientToPlayerRelation}}.insert(\{\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{client}}.playerId,\ \mbox{\hyperlink{engine_2ecs_2ecs_8hpp_a5a868f82168f3b251aa7ca758686125c}{newEntity}}\ \});}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \ \ \ \ \ \ this-\/>\mbox{\hyperlink{classServer_ace7288eb50463b9c25caacef2952c00b}{\_nbPlayer}}++;}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00320\ \ \ \ \ \}}
\DoxyCodeLine{00321\ \}}
\DoxyCodeLine{00322\ }
\DoxyCodeLine{00323\ \textcolor{comment}{//\ SafeQueue<std::pair<int,\ InputState>>\ \&Server::getRecievedInput()}}
\DoxyCodeLine{00324\ \textcolor{comment}{//\ \{}}
\DoxyCodeLine{00325\ \textcolor{comment}{//\ \ \ \ \ return\ \_UDP.receivedInputs;}}
\DoxyCodeLine{00326\ \textcolor{comment}{//\ \}}}
\DoxyCodeLine{00327\ }
\DoxyCodeLine{00328\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ !SERVER\_HPP\_\ */}\textcolor{preprocessor}{}}

\end{DoxyCode}
